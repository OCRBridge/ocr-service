openapi: 3.0.3
info:
  title: RESTful OCR API - ocrmac Upload Endpoint
  description: |
    Dedicated endpoint for uploading documents to be processed with the ocrmac OCR engine (macOS only).
    Supports ocrmac-specific parameters (languages, recognition_level).

    **Platform Requirement**: This endpoint is only available on macOS 10.15+ systems.
    Requests on other platforms will return HTTP 400 error.
  version: 1.0.0
  contact:
    name: RESTful OCR Support

servers:
  - url: http://localhost:8000
    description: Local development server

paths:
  /upload/ocrmac:
    post:
      summary: Upload document for ocrmac OCR processing (macOS only)
      description: |
        Upload a document (JPEG, PNG, PDF, TIFF) for OCR processing using the ocrmac engine.
        Processing happens asynchronously. Use the returned job_id to poll status and retrieve results.

        **Platform Requirement**: macOS 10.15+ (Catalina or newer) with Apple's Vision framework.

        **Default Behavior** (no parameters):
        - Languages: Automatic detection (all supported languages)
        - Recognition Level: balanced (good accuracy, reasonable speed)

        **Common Use Cases**:
        - English document: `languages=en-US`
        - French document: `languages=fr-FR`
        - Multilingual: `languages=en-US,fr-FR,de-DE`
        - Fast processing: `languages=en-US&recognition_level=fast`
        - Maximum accuracy: `languages=en-US&recognition_level=accurate`

      operationId: uploadDocumentOcrmac
      tags:
        - Upload
        - ocrmac

      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Document file to process (JPEG, PNG, PDF, TIFF)

                languages:
                  type: array
                  items:
                    type: string
                    pattern: '^[a-z]{2,3}(-[A-Z][a-z]{3})?(-[A-Z]{2})?$'
                  minItems: 1
                  maxItems: 5
                  description: |
                    Language codes for OCR recognition in IETF BCP 47 format.
                    Multiple languages can be specified (max 5).

                    **Format**: language[-Script][-Region]
                    - Language: 2-3 letter ISO 639 code (e.g., en, fr, zh)
                    - Script (optional): 4-letter ISO 15924 code (e.g., Hans, Hant)
                    - Region (optional): 2-letter ISO 3166-1 code (e.g., US, FR, CN)

                    **Common codes**:
                    - en-US (English - United States)
                    - fr-FR (French - France)
                    - de-DE (German - Germany)
                    - es-ES (Spanish - Spain)
                    - zh-Hans (Chinese - Simplified)
                    - zh-Hant (Chinese - Traditional)
                    - ja-JP (Japanese - Japan)
                    - ko-KR (Korean - South Korea)

                    **Omit for automatic language detection** (all supported languages)

                    **Examples**: ['en-US'], ['en-US', 'fr-FR'], ['zh-Hans']
                  example: ["en-US"]

                recognition_level:
                  type: string
                  enum:
                    - fast
                    - balanced
                    - accurate
                  description: |
                    Recognition level controlling speed vs accuracy trade-off.

                    - **fast**: Fewer languages supported, faster processing, acceptable accuracy
                    - **balanced**: Good accuracy with reasonable speed (default)
                    - **accurate**: Maximum accuracy, slower processing

                    **Use fast for**: Simple documents (receipts, forms with clear text)
                    **Use balanced for**: Most documents (default, good trade-off)
                    **Use accurate for**: Complex documents (handwriting, poor quality scans)
                  default: balanced
                  example: balanced

            encoding:
              file:
                contentType: image/jpeg, image/png, application/pdf, image/tiff
              languages:
                style: form
                explode: true

      responses:
        '202':
          description: Upload accepted, processing started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
              example:
                job_id: "123e4567-e89b-12d3-a456-426614174000"
                status: "pending"

        '400':
          description: Invalid request (bad parameters, platform incompatibility, validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                platform_incompatible:
                  summary: Non-macOS platform
                  value:
                    detail: "ocrmac engine is only available on darwin (macOS) systems. Current platform: linux"
                invalid_language_format:
                  summary: Invalid language code format
                  value:
                    detail: "Invalid IETF BCP 47 language code: 'eng'. Expected format: 'en-US', 'fr-FR', 'zh-Hans'"
                too_many_languages:
                  summary: Too many languages
                  value:
                    detail: "Maximum 5 languages allowed"
                unsupported_language:
                  summary: Language not supported by ocrmac
                  value:
                    detail: "Unsupported language codes for ocrmac: hi-IN. Supported: en, fr, de, es, it, pt, ru, ar, zh-Hans, zh-Hant, ja, ko, th, vi"
                invalid_recognition_level:
                  summary: Invalid recognition level
                  value:
                    detail: "Invalid recognition level: 'ultra'. Allowed: fast, balanced, accurate"

        '413':
          description: File too large (>25MB)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "File size exceeds maximum allowed size of 25MB"

        '415':
          description: Unsupported file format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "Unsupported file format: application/msword. Supported: image/jpeg, image/png, application/pdf, image/tiff"

        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "Rate limit exceeded: 100 requests per minute"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                ocrmac_not_installed:
                  summary: ocrmac not installed
                  value:
                    detail: "ocrmac engine is not installed on this system. Please install ocrmac package."
                processing_failed:
                  summary: General processing error
                  value:
                    detail: "Upload failed"

        '503':
          description: ocrmac engine unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "ocrmac engine is currently unavailable"

components:
  schemas:
    UploadResponse:
      type: object
      required:
        - job_id
        - status
      properties:
        job_id:
          type: string
          format: uuid
          description: Unique job identifier for status polling and result retrieval
          example: "123e4567-e89b-12d3-a456-426614174000"
        status:
          type: string
          enum:
            - pending
            - processing
            - completed
            - failed
          description: Current job status
          example: pending

    ErrorResponse:
      type: object
      required:
        - detail
      properties:
        detail:
          oneOf:
            - type: string
            - type: array
              items:
                type: object
          description: Error message or list of validation errors
          example: "Invalid request parameter"
